
<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../elements/sapo-selector-crud.html">

<dom-module id="sapo-indicadores">

  <template>

    <style include="iron-flex iron-flex-factors">
      paper-card {
        margin-left: 80px;
        margin-right: 80px;
      }
    </style>

    <app-route
      route="{{route}}"
      pattern="/:indicador"
      data="{{routeData}}"
      tail="{{subroute}}">
    </app-route>

    <iron-ajax auto url="http://N350i-22878:8080/indicadores/" last-response="{{indicadores}}"></iron-ajax>
    <iron-ajax id="getPilaresAjax" url="http://N350i-22878:8080/pilares/indicador/[[selectedIndicador]]" last-response="{{pilares}}"></iron-ajax>
    <iron-ajax id="getTiposAjax" url="http://N350i-22878:8080/tipos/pilar/[[selectedPilar]]" last-response="{{tipos}}"></iron-ajax>
    <iron-ajax id="getNiveisAjax" url="http://N350i-22878:8080/niveis/tipo/[[selectedTipo]]" last-response="{{niveis}}"></iron-ajax>
    <iron-ajax id="getSubniveisAjax" url="http://N350i-22878:8080/subniveis/nivel/[[selectedNivel]]" last-response="{{subniveis}}"></iron-ajax>

    <paper-card class="layout vertical fit">

      <sapo-selector-crud id="indicadorSelector" label="Indicador" data="[[indicadores]]" selected="{{selectedIndicador}}" ></sapo-selector-crud>
      <sapo-selector-crud id="pilarSelector" label="Pilar" data="[[pilares]]" selected="{{selectedPilar}}"></sapo-selector-crud>
      <sapo-selector-crud id="tipoSelector" label="Tipo" data="[[tipos]]" selected="{{selectedTipo}}"></sapo-selector-crud>
      <sapo-selector-crud id="nivelSelector" label="Nivel" data="[[niveis]]" selected="{{selectedNivel}}"></sapo-selector-crud>
      <sapo-selector-crud id="subnivelSelector" label="SubnÃ­vel" data="[[subniveis]]" selected="{{selectedSubnivel}}"></sapo-selector-crud>

    </paper-card>

  </template>

  <script>
    class SapoIndicadores extends Polymer.Element {

      static get is() { return 'sapo-indicadores'; }

      static get properties() {
        return {
          selectedIndicador: {
            type: Number,
            observer: '_indicadorChanged'
          },
          selectedPilar: {
            type: Number,
            observer: '_pilarChanged'
          },
          selectedTipo: {
            type: Number,
            observer: '_tipoChanged'
          },
          selectedNivel: {
            type: Number,
            observer: '_nivelChanged'
          },
          selectedSubnivel: {
            type: Number,
            observer: '_subnivelChanged'
          },
          indicadores: Array,
          pilares: Array,
          tipos: Array,
          niveis: Array,
          subniveis: Array
        }
      }

      constructor() {
        super();
      }

      _indicadorChanged(newId, oldId) {
        this.$.pilarSelector.disabled = (newId === 0);
        this.$.getPilaresAjax.generateRequest();
      }

      _pilarChanged(newId, oldId) {
        this.$.tipoSelector.disabled = (newId === 0);
        this.$.getTiposAjax.generateRequest();
      }

      _tipoChanged(newId, oldId) {
        this.$.nivelSelector.disabled = (newId === 0);
        this.$.getNiveisAjax.generateRequest();
      }

      _nivelChanged(newId, oldId) {
        this.$.subnivelSelector.disabled = (newId === 0);
        this.$.getSubniveisAjax.generateRequest();
      }

      _subnivelChanged(newId, oldId) {

      }

    }

    window.customElements.define(SapoIndicadores.is, SapoIndicadores);
  </script>
</dom-module>
