<link rel="import" href="/bower_components/polymer/polymer-element.html">
<link rel="import" href="/bower_components/paper-card/paper-card.html">
<link rel="import" href="/elements/sapo-poor-selector.html">

<dom-module id="sapo-list-notas">

  <template>

    <style>

      table {
        width: 100%;
      }

      thead {
        text-align: left;
      }

      th, td {
        padding: 10px;
      }
    </style>

    <table>
      <thead>
        <th style="min-width:200px">Item</th>
        <th style="width:100%">ExigÃªncia</th>
        <th style="width:100px">Nota</th>
      </thead>
      <tbody>
        <template is="dom-repeat" items="[[data]]">
          <tr hidden="[[_isNotaHidden(item.id, idsToShow)]]" >
            <td>[[item.item.nome]]</td>
            <td>[[item.item.exigencia]]</td>
            <td>
              <sapo-poor-selector on-select="_notaChanged" selected="{{item.pontuacao_id}}" data="[[_computeSelectorData(item.item.pontuacoes)]]" ></sapo-selector>
            </td>
          </tr>
        </template>
      </tbody>
    </table>

  </template>

  <script>
    class SapoListNotas extends Polymer.Element {

      static get is() { return 'sapo-list-notas'; }

      static get properties() {
        return {
          data: Array,
          idsToShow: Array
        }
      }

      _computeSelectorData(pontuacoes) {
        return pontuacoes.map(pontuacao => { return { identity: pontuacao.id, text: pontuacao.nota + ' - ' + pontuacao.descricao }; });
      }

      _notaChanged(e) {
        this.dispatchEvent(new CustomEvent('nota-changed', {detail: {nota_id: e.model.item.id, pontuacao_id: e.detail.id}}));
      }

      _isNotaHidden(itemId, idsToShow) {
        return !idsToShow.some(id => id === itemId);
      }

    }

    window.customElements.define(SapoListNotas.is, SapoListNotas);
  </script>
</dom-module>
